<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of sosCorrelTest</title>
  <meta name="keywords" content="sosCorrelTest">
  <meta name="description" content="- test for equivalence of two correlations">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="#">src</a> &gt; sosCorrelTest.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for .\src&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>sosCorrelTest
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>- test for equivalence of two correlations</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> - test for equivalence of two correlations

 copyright 2009-2012 Blair Armstrong, Christine Watson, David Plaut

    This file is part of SOS

    SOS is free software: you can redistribute it and/or modify
    it for academic and non-commercial purposes
    under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.  For commercial or for-profit
    uses, please contact the authors (sos@cnbc.cmu.edu).

    SOS is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="sosCorrelTest.html" class="code" title="">sosCorrelTest</a>	- test for equivalence of two correlations</li><li><a href="verbosePrint.html" class="code" title="function verbosePrint(msg,fieldName)">verbosePrint</a>	- master print function that regulates cmd line output based on verbosity flags</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="genericStatTest.html" class="code" title="">genericStatTest</a>	- parent class for statistical test objects</li><li><a href="sosCorrelTest.html" class="code" title="">sosCorrelTest</a>	- test for equivalence of two correlations</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="#_sub1" class="code">function obj = sosCorrelTest(varargin)</a></li><li><a href="#_sub2" class="code">function [userHypothesis, prob, label] = runTest(obj,varargin)</a></li><li><a href="#_sub3" class="code">function [userHypothesis, prob, label] =</a></li><li><a href="#_sub4" class="code">function constructMatchCorrelztest(obj,sosObj,varargin)</a></li><li><a href="#_sub5" class="code">function userHypothesis = returnNaN(~,~)</a></li><li><a href="#_sub6" class="code">function flag = validTestType(str)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">% - test for equivalence of two correlations</span>
0002 <span class="comment">%</span>
0003 <span class="comment">% copyright 2009-2012 Blair Armstrong, Christine Watson, David Plaut</span>
0004 <span class="comment">%</span>
0005 <span class="comment">%    This file is part of SOS</span>
0006 <span class="comment">%</span>
0007 <span class="comment">%    SOS is free software: you can redistribute it and/or modify</span>
0008 <span class="comment">%    it for academic and non-commercial purposes</span>
0009 <span class="comment">%    under the terms of the GNU General Public License as published by</span>
0010 <span class="comment">%    the Free Software Foundation, either version 3 of the License, or</span>
0011 <span class="comment">%    (at your option) any later version.  For commercial or for-profit</span>
0012 <span class="comment">%    uses, please contact the authors (sos@cnbc.cmu.edu).</span>
0013 <span class="comment">%</span>
0014 <span class="comment">%    SOS is distributed in the hope that it will be useful,</span>
0015 <span class="comment">%    but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
0016 <span class="comment">%    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
0017 <span class="comment">%    GNU General Public License for more details.</span>
0018 
0019 <span class="comment">%    You should have received a copy of the GNU General Public License</span>
0020 <span class="comment">%    along with SOS (see COPYING.txt).</span>
0021 <span class="comment">%    If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
0022 
0023 
0024 classdef <a href="sosCorrelTest.html" class="code" title="">sosCorrelTest</a> &lt; handle
0025     <span class="comment">% runs user-specified z-tests on equivalence of a sample and a specified</span>
0026     <span class="comment">% target (population) correlation coefficient,</span>
0027     <span class="comment">% and tests user hypotheses on their outcomes</span>
0028     <span class="comment">% NOTE: This uses a z-score approximation when testing the equivalence</span>
0029     <span class="comment">%   of the sample and population correlation coefficients.  Using</span>
0030     <span class="comment">%   sample sizes &lt; 10 is not recommended, and a sample size of at least</span>
0031     <span class="comment">%   4 is required to have sufficient df for the test.</span>
0032     <span class="comment">%   Additionally, you should avoid trying to match to a correlation of</span>
0033     <span class="comment">%   1.0, beceause that is undefined in the equation.</span>
0034     <span class="comment">%   Further, note that for a same p-value, closer matches are required</span>
0035     <span class="comment">%   nearer to a correlation of 1.0 than to a correlation of 0, by</span>
0036     <span class="comment">%   virtue of the nonlinearity which is part of the stats test.</span>
0037     <span class="comment">%</span>
0038     <span class="comment">%PROPERTIES</span>
0039     <span class="comment">%     sosObj % sos object the test is associated with</span>
0040     <span class="comment">%     name % string label to associate with the test</span>
0041     <span class="comment">%     s1 % sample1</span>
0042     <span class="comment">%     s2 % sample2</span>
0043     <span class="comment">%     s1ColName % column name of data in sample1</span>
0044     <span class="comment">%     s2ColName % column name of data in sample2</span>
0045     <span class="comment">%     s1Col   % column index in sample1</span>
0046     <span class="comment">%     s2Col   % column index in sample2</span>
0047     <span class="comment">%     type    % type of ztest (currently only 'matchCorrel')</span>
0048     <span class="comment">%     runSpecificTest % handle to specific test method</span>
0049     <span class="comment">%     desiredpvalCondition % indicates the desired outcome of the test, either NaN, &lt;= or &gt;=</span>
0050     <span class="comment">%     desiredpvalConditionHandle  % handle to the function that will evaluate whether the desiredpValCondition was met</span>
0051     <span class="comment">%     desiredpval % desired p-val to test against</span>
0052     <span class="comment">%     targValue % target correlation value for the test</span>
0053     <span class="comment">%     tail % tail of test.  left -&gt; t-vals &lt; 0, right = t-vals &gt; 0; both = pos. and neg. z-score will reject the null</span>
0054     <span class="comment">%     lastp % last p-value that was calcualted</span>
0055     <span class="comment">%</span>
0056     <span class="comment">%METHODS:</span>
0057     <span class="comment">%   sosCorrelTest(sosObj,varargin)  %constructs an sosCorrelTest object of the specified type.</span>
0058     <span class="comment">%   constructMatchCorrelztest(obj,sosObj,varargin)  %initialize object</span>
0059     <span class="comment">%   [userHypothesis, prob, label] = runTest(obj,varargin) %runs the test</span>
0060     <span class="comment">%   [userHypothesis, prob, label] =  runMatchCorrelztest(obj,varargin) % runs a matchCorrel test</span>
0061     <span class="comment">%</span>
0062     <span class="comment">%METHODS (Static)</span>
0063     <span class="comment">%   userHypothesis = returnNaN(~,~)  % returns NaN</span>
0064     <span class="comment">%   flag = validTestType(str) % returns 1 if the name of type of test is 'matchCorrel'; error otherwise.</span>
0065 
0066     
0067     <span class="comment">%% PROPERTIES</span>
0068     properties
0069         sosObj <span class="comment">% sos object the test is associated with</span>
0070         name <span class="comment">% string label to associate with the test</span>
0071         s1 <span class="comment">% sample1</span>
0072         s2 <span class="comment">% sample2</span>
0073         s1ColName <span class="comment">% column name of data in sample1</span>
0074         s2ColName <span class="comment">% column name of data in sample2</span>
0075         s1Col   <span class="comment">% column index in sample1</span>
0076         s2Col   <span class="comment">% column index in sample2</span>
0077         type    <span class="comment">% type of ttest (paired,independent,</span>
0078         runSpecificTest <span class="comment">% handle to specific test method</span>
0079         desiredpvalCondition <span class="comment">% indicates the desired outcome of the test, either NaN, &lt;= or &gt;=</span>
0080         desiredpvalConditionHandle  <span class="comment">% handle to the function that will evaluate whether the desiredpValCondition was met</span>
0081         desiredpval <span class="comment">% desired p-val to test against</span>
0082         targVal <span class="comment">% target value for single-sample ttest</span>
0083         tail <span class="comment">% tail of test.  left -&gt; t-vals &lt; 0, right = t-vals &gt; 0; both = pos. and neg. t will reject the null</span>
0084         lastp <span class="comment">% last p-value that was calcualted</span>
0085         label <span class="comment">% label denoting what is being tested</span>
0086     <span class="keyword">end</span> <span class="comment">% properties</span>
0087     
0088     methods
0089         
0090         <span class="comment">%% sosCorrelTest CONSTRUCTOR</span>
0091         <a name="_sub0" href="#_subfunctions" class="code">function obj = sosCorrelTest(varargin)</a>
0092             <span class="comment">%constructs an sosCorrelTest object of the specified type.</span>
0093             <span class="comment">%</span>
0094             <span class="comment">%PARAMETERS:</span>
0095             <span class="comment">% sosObj - sosObject test will be associated with</span>
0096             <span class="comment">% 'type'/string, type of test - ('matchCorrel' only currently)</span>
0097             <span class="comment">% 'sample1'/sample - a sample associated with sosObj.</span>
0098             <span class="comment">% ... Other parameters as required by the constructor for the</span>
0099             <span class="comment">% specific type of t-test requested.  See those constructors</span>
0100             <span class="comment">% for additional info.</span>
0101             <span class="comment">%</span>
0102             <span class="comment">% Returns an sosCorrelTest object.</span>
0103             
0104 
0105             <span class="comment">% perform basic checks for universally required components of</span>
0106             <span class="comment">% the z-test</span>
0107             p = inputParser;
0108             p.addParamValue(<span class="string">'sosObj'</span>, <span class="string">'null'</span>,<span class="keyword">...</span>
0109                 @(sosObj)strcmp(class(sosObj),<span class="string">'sos'</span>));
0110             p.addParamValue(<span class="string">'type'</span>,<span class="string">'null'</span>, <span class="keyword">...</span>
0111                 @(type)sosCorrelTest.validTestType(type));
0112             p.addParamValue(<span class="string">'sample1'</span>,<span class="string">'null'</span>, <span class="keyword">...</span>
0113                             @(sample1)strcmp(class(sample1),<span class="string">'sample'</span>));            
0114             p.addParamValue(<span class="string">'name'</span>,<span class="string">'noname'</span>,@(name)ischar(name));
0115             
0116             <span class="comment">%keep all of the parameters for specific t-tests</span>
0117             p.KeepUnmatched = true;
0118             p.parse(varargin{:});
0119 
0120             
0121             
0122             <span class="comment">%basic checks are passed, construct the specific type of t-test</span>
0123             <span class="comment">%that has been requested</span>
0124 
0125            sosObj = p.Results.sosObj; <span class="comment">%#ok&lt;PROP&gt;</span>
0126            
0127             <span class="keyword">if</span>(strcmp(p.Results.type,<span class="string">'matchCorrel'</span>))
0128                 obj.constructMatchCorrelztest(sosObj,varargin{:}) <span class="comment">%#ok&lt;PROP&gt;</span>
0129             <span class="keyword">else</span> 
0130                error([<span class="string">'Specified &lt;type&gt;: '</span>,p.Results.type, <span class="keyword">...</span>
0131                         <span class="string">' is not supported'</span>]);  
0132             <span class="keyword">end</span>
0133 
0134             obj.lastp = NaN;
0135             obj.sosObj = p.Results.sosObj;
0136             
0137             <span class="comment">% add the test's name.</span>
0138             <span class="keyword">if</span> any(strcmp(p.UsingDefaults,<span class="string">'name'</span>))
0139                  
0140                  numTests = length(obj.sosObj.sosstattests);
0141                 
0142              obj.name = [<span class="string">'ztest_'</span>,num2str(numTests+1)];  
0143              <span class="keyword">else</span>
0144                  obj.name = p.Results.name;  
0145              <span class="keyword">end</span>
0146             
0147         <span class="keyword">end</span> <span class="comment">% Constructor</span>
0148         
0149 
0150         <span class="comment">%% [userHypothesis, prob, label] = runTest(obj,varargin) METHOD</span>
0151         <a name="_sub1" href="#_subfunctions" class="code">function [userHypothesis, prob, label] = runTest(obj,varargin)</a>
0152             <span class="comment">%runs the ztest</span>
0153             <span class="comment">%</span>
0154             <span class="comment">% PARAMETERS:</span>
0155             <span class="comment">% 'reportStyle'/'short'|'full'/'none' - style of report to be</span>
0156             <span class="comment">%           printed.  Either none, short or full</span>
0157             <span class="comment">%</span>
0158             <span class="comment">% RETURNS:</span>
0159             <span class="comment">%   userHypothesis - whether the user's hypothesis has been met or not. NaN if no user hypothesis for the test.</span>
0160             <span class="comment">%   prob - p-value from the ttest</span>
0161             <span class="comment">%   label - string label denoting what was tested.</span>
0162             
0163             [userHypothesis, prob, label] = obj.runSpecificTest(varargin);
0164             obj.lastp = prob;
0165         <span class="keyword">end</span>
0166         
0167         
0168         <span class="comment">%% [userHypothesis, prob, label] =  runMatchCorrelztest(varargin) METHOD</span>
0169         <a name="_sub2" href="#_subfunctions" class="code">function [userHypothesis, prob, label] = </a><span class="keyword">...</span>
0170                 runMatchCorrelztest(obj,varargin)
0171             <span class="comment">%runs a matchCorrel test</span>
0172             <span class="comment">%</span>
0173             <span class="comment">% PARAMETERS:</span>
0174             <span class="comment">% 'reportStyle'/'short'|'full' - style of report to be printed.  Either short or long</span>
0175             <span class="comment">%</span>
0176             <span class="comment">% RETURNS:</span>
0177             <span class="comment">%   userHypothesis - whether the user's hypothesis has been met or not. NaN if no user hypothesis for the test.</span>
0178             <span class="comment">%   prob - p-value from the ttest</span>
0179             <span class="comment">%   label - string label denoting what was tested.</span>
0180                      
0181             
0182             varargin = varargin{1};
0183                       
0184             p = inputParser;
0185             
0186             p.addParamValue(<span class="string">'reportStyle'</span>,<span class="string">'short'</span>, <span class="keyword">...</span>
0187                     @(reportStyle)any([strcmp(reportStyle,<span class="string">'short'</span>) <span class="keyword">...</span>
0188                                     strcmp(reportStyle,<span class="string">'full'</span>) <span class="keyword">...</span>
0189                                     strcmp(reportStyle,<span class="string">'none'</span>)]));
0190             p.parse(varargin{:});
0191 
0192             
0193             reportStyle = p.Results.reportStyle;
0194 
0195             
0196             
0197             <span class="comment">% Run the stats test</span>
0198             sumx1sq = sum((obj.s1.zdata{obj.s1Col}).^2);
0199             sumx1 = sum((obj.s1.zdata{obj.s1Col}));
0200             n1 = length(obj.s1.zdata{obj.s1Col});
0201             
0202             sumx2sq = sum((obj.s2.zdata{obj.s2Col}).^2);
0203             sumx2 = sum((obj.s2.zdata{obj.s2Col}));
0204             n2 = length(obj.s2.zdata{obj.s2Col});
0205             
0206             sumx1x2 = (obj.s1.zdata{obj.s1Col})' * (obj.s2.zdata{obj.s2Col});
0207             
0208             ssx1 = sumx1sq - ((sumx1)^2)/n1;
0209             ssx2 = sumx2sq - ((sumx2)^2)/n2;
0210             
0211             spx1x2 = sumx1x2 - sumx1*sumx2/n1;
0212             
0213             <span class="comment">% defining overrides...</span>
0214             <span class="keyword">if</span>(ssx1 == 0 &amp;&amp; ssx2 == 0) <span class="comment">% no variance in either condition, define correlation as being perfect in this case</span>
0215                 cor = 1;
0216             <span class="keyword">elseif</span>(ssx1 == 0 || ssx2 == 0)
0217                 cor = 0;
0218             <span class="keyword">else</span> <span class="comment">% compute correlation normally</span>
0219                 cor = spx1x2/(sqrt(ssx1)*sqrt(ssx2));
0220             <span class="keyword">end</span>
0221             
0222             <span class="comment">% convert correlation to z-score</span>
0223             
0224             r= cor;
0225             
0226             <span class="keyword">if</span> n1 &gt; 4
0227                 <span class="comment">% we can compute the z-score</span>
0228                 
0229                 z = (0.5*log((1+r)/(1-r)) - 0.5*log((1+obj.targVal)/(1-obj.targVal))) <span class="keyword">...</span>
0230                         /(1/sqrt(n1-3));
0231                 [h,prob,ci,stats] = ztest(z,0,1);     <span class="comment">%#ok&lt;ASGLU&gt;</span>
0232             <span class="keyword">else</span>
0233                 <span class="comment">%we can't convert sinze formula has sqrt of N-3 in denom</span>
0234                 
0235                 <span class="comment">%special override cases...</span>
0236             <span class="keyword">end</span>
0237             
0238             
0239 <span class="comment">% From ttest code.  Can remove.</span>
0240 <span class="comment">%             % if prob was NaN, it's because the denominator in the t-test</span>
0241 <span class="comment">%             % was 0.  So just check the means manually to determine</span>
0242 <span class="comment">%             % prob</span>
0243 <span class="comment">%             if isnan(prob)</span>
0244 <span class="comment">%              m1 = mean(obj.s1.data{obj.s1Col});</span>
0245 <span class="comment">%              m2 = mean(obj.s2.data{obj.s2Col});</span>
0246 <span class="comment">%</span>
0247 <span class="comment">%              if m1==m2</span>
0248 <span class="comment">%                  prob = 1;</span>
0249 <span class="comment">%              else</span>
0250 <span class="comment">%                  prob = 0;</span>
0251 <span class="comment">%              end</span>
0252 <span class="comment">%</span>
0253 <span class="comment">%             end</span>
0254              
0255             userHypothesis = obj.desiredpvalConditionHandle(<span class="keyword">...</span>
0256                                   prob,obj.desiredpval);
0257              
0258              label = [obj.s1.name, <span class="string">'{'</span>,obj.s1ColName, <span class="string">'}-'</span>, <span class="keyword">...</span>
0259                     obj.s2.name, <span class="string">'{'</span>,obj.s2ColName, <span class="string">'}'</span>];
0260              
0261              <span class="keyword">if</span> (isnan(userHypothesis))
0262                  printHyp = <span class="string">'N/A'</span>;
0263              <span class="keyword">elseif</span> userHypothesis == 1
0264                  printHyp = <span class="string">'PASS'</span>;
0265              <span class="keyword">elseif</span> userHypothesis == 0
0266                  printHyp = <span class="string">'FAIL'</span>;
0267              <span class="keyword">end</span>
0268                  
0269              
0270              <span class="keyword">if</span> (strcmp(reportStyle,<span class="string">'short'</span>))
0271                 <a href="verbosePrint.html" class="code" title="function verbosePrint(msg,fieldName)">verbosePrint</a>([<span class="string">' UserHyp: '</span>, printHyp, <span class="string">'; '</span>, label, <span class="string">': '</span>, <span class="keyword">...</span>
0272                      <span class="string">'z['</span>,obj.type,<span class="string">']('</span>,num2str(n1),<span class="string">') = '</span>, <span class="keyword">...</span>
0273                      num2str(stats), <span class="string">', p = '</span>, num2str(prob), <span class="keyword">...</span>
0274                      <span class="string">' p-des: '</span>,num2str(obj.desiredpval)], <span class="keyword">...</span>
0275                      <span class="string">'sosCorrelTest_runMatchCorrelztest'</span>);
0276              <span class="keyword">elseif</span> (strcmp(reportStyle,<span class="string">'full'</span>))
0277                  <a href="verbosePrint.html" class="code" title="function verbosePrint(msg,fieldName)">verbosePrint</a>([<span class="string">' UserHyp: '</span>, printHyp , <span class="keyword">...</span>
0278                      <span class="string">'; '</span>, label, <span class="string">': '</span>, <span class="keyword">...</span>
0279                      <span class="string">'z['</span>,obj.type,<span class="string">']('</span>,num2str(n1),<span class="string">') = '</span>, <span class="keyword">...</span>
0280                      num2str(stats), <span class="string">', p = '</span>, num2str(prob), <span class="keyword">...</span><span class="comment">  </span>
0281                      <span class="string">' p-des: '</span>,num2str(obj.desiredpval), <span class="keyword">...</span>
0282                      <span class="string">' cor = '</span>, num2str(r),<span class="string">' targCor = '</span>, num2str(obj.targVal)], <span class="keyword">...</span>
0283                      <span class="string">'sosCorrelTest_runMatchCorrelztest'</span>);
0284              <span class="keyword">end</span>                            
0285         <span class="keyword">end</span> 
0286 
0287         
0288  
0289         
0290         <span class="comment">%% constructMatchCorrelztest(sosObj,varargin) METHOD</span>
0291         <a name="_sub3" href="#_subfunctions" class="code">function constructMatchCorrelztest(obj,sosObj,varargin)</a>
0292             <span class="comment">%initialize an matchCorrel z-test object.</span>
0293             <span class="comment">% Assumes equal variance.</span>
0294             <span class="comment">%</span>
0295             <span class="comment">% PARAMETERS:</span>
0296             <span class="comment">% Required:</span>
0297             <span class="comment">%   sosObj - sos Object test is to be associated with</span>
0298             <span class="comment">%   sample1 - a sample object</span>
0299             <span class="comment">%   sample2 - a sample object</span>
0300             <span class="comment">%   s1ColName - name of data column in sample1</span>
0301             <span class="comment">%   s2ColName - name of data column in sample2</span>
0302             <span class="comment">%</span>
0303             <span class="comment">% Optional:</span>
0304             <span class="comment">%   desiredpvalCondition/string - desired condition for the ttest</span>
0305             <span class="comment">%       pval. Either it should exceed (=&gt;) some value, be less</span>
0306             <span class="comment">%       than '&lt;=' some condition, or be 'N/A' if there is no</span>
0307             <span class="comment">%       desired condition.  Default is N/A.  Note that the</span>
0308             <span class="comment">%       ordering of '=' and '&lt;' is important, so though '&lt;=' is</span>
0309             <span class="comment">%       valid, '=&lt;' is not.</span>
0310             <span class="comment">%   desiredpval - desired p-value to evaluate the condition</span>
0311             <span class="comment">%       against.  Defaults to 0.05</span>
0312             <span class="comment">%   tail - tail of test - left/right/both</span>
0313             <span class="comment">%   targVal - the target correlation value to match (must be in</span>
0314             <span class="comment">%   range (-1,1) (note round, not square brackets, as -1 and 1</span>
0315             <span class="comment">%   are NOTE allowed)</span>
0316             <span class="comment">%</span>
0317             <span class="comment">% RETURNS:</span>
0318             <span class="comment">%   Configured sosCorrelTest object.</span>
0319             
0320 
0321             p = inputParser;
0322 
0323             p.addRequired(<span class="string">'sosObj'</span>, <span class="keyword">...</span>
0324                 @(sosObj)strcmp(class(sosObj),<span class="string">'sos'</span>));
0325             p.addParamValue(<span class="string">'type'</span>,<span class="string">'null'</span>, <span class="keyword">...</span>
0326                 @(type)sosCorrelTest.validTestType(type));
0327             p.addParamValue(<span class="string">'sample1'</span>,<span class="string">'null'</span>, <span class="keyword">...</span>
0328                         @(sample1)strcmp(class(sample1),<span class="string">'sample'</span>));
0329             p.addParamValue(<span class="string">'sample2'</span>,<span class="string">'null'</span>, <span class="keyword">...</span>
0330                         @(sample2)strcmp(class(sample2),<span class="string">'sample'</span>));
0331             <span class="comment">%NaN will fail by default</span>
0332             p.addParamValue(<span class="string">'s1ColName'</span>,NaN, <span class="keyword">...</span>
0333                 @(s1ColName)ischar(s1ColName));
0334             p.addParamValue(<span class="string">'s2ColName'</span>,NaN, <span class="keyword">...</span>
0335                 @(s2ColName)ischar(s2ColName));
0336             p.addParamValue(<span class="string">'desiredpvalCondition'</span>,<span class="string">'N/A'</span>, <span class="keyword">...</span>
0337                 @(desiredpvalCondition)any([strcmp(desiredpvalCondition,<span class="string">'&lt;='</span>), <span class="keyword">...</span>
0338                             strcmp(desiredpvalCondition,<span class="string">'=&gt;'</span>), <span class="keyword">...</span>
0339                             strcmp(desiredpvalCondition,<span class="string">'N/A'</span>)]));
0340             p.addParamValue(<span class="string">'desiredpval'</span>, 0.05, <span class="keyword">...</span>
0341                 @(desiredpval)validateattributes(desiredpval, <span class="keyword">...</span>
0342                     {<span class="string">'numeric'</span>}, <span class="keyword">...</span>
0343                     {<span class="string">'scalar'</span>, <span class="string">'positive'</span>, <span class="string">'&gt;='</span>, 0, <span class="string">'&lt;='</span>, 1}));
0344             p.addParamValue(<span class="string">'tail'</span>,<span class="string">'both'</span>, <span class="keyword">...</span>
0345                 @(tail)any([strcmp(tail,<span class="string">'both'</span>), strcmp(tail,<span class="string">'left'</span>),strcmp(tail,<span class="string">'right'</span>)]));
0346             p.addParamValue(<span class="string">'name'</span>,<span class="string">'noname'</span>,@(name)ischar(name)); <span class="comment">% dealt with in the main constructor</span>
0347             p.addParamValue(<span class="string">'targVal'</span>,0.0, <span class="keyword">...</span><span class="comment"> </span>
0348                 @(targVal)validateattributes(targVal, <span class="keyword">...</span>
0349                     {<span class="string">'numeric'</span>}, <span class="keyword">...</span>
0350                     {<span class="string">'scalar'</span>, <span class="string">'&gt;='</span>, -1, <span class="string">'&lt;='</span>, 1}));
0351             p.parse(sosObj,varargin{:});
0352 
0353 
0354             sample1 = p.Results.sample1;
0355             sample2 = p.Results.sample2;
0356             s1ColName = p.Results.s1ColName; <span class="comment">%#ok&lt;PROP&gt;</span>
0357             s2ColName = p.Results.s2ColName; <span class="comment">%#ok&lt;PROP&gt;</span>
0358             obj.desiredpvalCondition = p.Results.desiredpvalCondition;
0359             
0360 
0361             <span class="keyword">if</span> strcmp(obj.desiredpvalCondition,<span class="string">'N/A'</span>)
0362                 obj.desiredpvalConditionHandle = @sosCorrelTest.returnNaN;
0363             <span class="keyword">elseif</span> strcmp(obj.desiredpvalCondition,<span class="string">'&lt;='</span>)
0364                 obj.desiredpvalConditionHandle = @le;
0365             <span class="keyword">elseif</span> strcmp(obj.desiredpvalCondition,<span class="string">'=&gt;'</span>)
0366                 obj.desiredpvalConditionHandle = @ge;
0367             <span class="keyword">end</span>
0368 
0369             <span class="comment">% can't have a desiredpval without a desiredpvalcondition</span>
0370             <span class="keyword">if</span> strcmp(obj.desiredpvalCondition,<span class="string">'N/A'</span>)
0371                 obj.desiredpval = NaN;
0372             <span class="keyword">else</span>
0373                 obj.desiredpval = p.Results.desiredpval;
0374             <span class="keyword">end</span>
0375 
0376 
0377             <span class="comment">% perform additional checks on the objects</span>
0378             
0379             present1 = sosObj.containsSample(sample1);
0380             <span class="keyword">if</span> (present1 == 0 )
0381                 error(<span class="string">'sos sosObject does not contain sample1'</span>);
0382             <span class="keyword">end</span>
0383 
0384             present2 = sosObj.containsSample(sample2);
0385             <span class="keyword">if</span> (present2 == 0 )
0386                 error(<span class="string">'sos sosObject does not contain sample2'</span>);
0387             <span class="keyword">end</span>               
0388 
0389             col1 = sample1.colName2colNum(s1ColName); <span class="comment">%#ok&lt;PROP&gt;</span>
0390             <span class="keyword">if</span>(col1 == -1)
0391                 error(<span class="string">'&lt;s1ColName&gt; not a column of data in &lt;sample1&gt;'</span>);
0392             <span class="keyword">end</span>
0393 
0394             col2 = sample1.colName2colNum(s2ColName); <span class="comment">%#ok&lt;PROP&gt;</span>
0395             <span class="keyword">if</span>(col2 == -1)
0396                 error(<span class="string">'&lt;s2ColName&gt; not a column of data in &lt;sample2&gt;'</span>);
0397             <span class="keyword">end</span>
0398             
0399             <span class="keyword">if</span> isempty(sample1.data)
0400                 error(<span class="string">'sample 1 does not contain items - did you fill it yet?'</span>);
0401             <span class="keyword">end</span>
0402             
0403             <span class="keyword">if</span> isempty(sample2.data)
0404                 error(<span class="string">'sample 2 does not contain items - did you fill it yet?'</span>);
0405             <span class="keyword">end</span>   
0406             <span class="comment">%all variables check out, create the stats test</span>
0407 
0408             
0409             <span class="keyword">if</span> (length(sample1.data{col1}) ~= length(sample2.data{col2}))
0410                 error(<span class="string">'Sample 1 and Sample 2 must have the same number of observations for a paired comparison'</span>);
0411             <span class="keyword">end</span>
0412             
0413             <span class="keyword">if</span> sample1.n &lt; 4
0414                 <span class="comment">% see note in the calculation for why the following is the</span>
0415                 <span class="comment">% case</span>
0416                 error(<span class="string">'The sosCorrelTest requires at least 4 items per sample'</span>);
0417             <span class="keyword">end</span>
0418             
0419             
0420             obj.s1 = sample1;
0421             obj.s2 = sample2;
0422             obj.s1ColName = s1ColName; <span class="comment">%#ok&lt;PROP&gt;</span>
0423             obj.s2ColName = s2ColName; <span class="comment">%#ok&lt;PROP&gt;</span>
0424             obj.s1Col = col1;
0425             obj.s2Col = col2;
0426             obj.type = p.Results.type;
0427             obj.tail = p.Results.tail;
0428             obj.targVal = p.Results.targVal;
0429 
0430             obj.runSpecificTest = @obj.runMatchCorrelztest;
0431             
0432             obj.label = [obj.s1.name, <span class="string">'{'</span>,obj.s1ColName, <span class="string">'}-'</span>, <span class="keyword">...</span>
0433                     obj.s2.name, <span class="string">'{'</span>,obj.s2ColName, <span class="string">'}'</span>, <span class="keyword">...</span>
0434                     <span class="string">':z['</span>,obj.type,<span class="string">']'</span>];            
0435           
0436                 
0437         <span class="keyword">end</span>
0438  
0439  
0440     <span class="keyword">end</span>
0441     
0442      
0443     methods (Static)
0444         
0445         <span class="comment">%% userHypothesis = returnNaN(~,~) STATIC FUNCTION</span>
0446         <a name="_sub4" href="#_subfunctions" class="code">function userHypothesis = returnNaN(~,~)</a>
0447             <span class="comment">% returns NaN</span>
0448             userHypothesis = NaN;
0449         <span class="keyword">end</span>
0450 
0451         <span class="comment">%%  flag = validTestType(str) STATIC FUNCTION</span>
0452         <a name="_sub5" href="#_subfunctions" class="code">function flag = validTestType(str)</a>
0453             <span class="comment">% returns 1 if the name of type of test is 'matchCorrel'; error otherwise.</span>
0454             
0455             flag = 0; <span class="comment">%#ok&lt;NASGU&gt;</span>
0456             
0457             <span class="keyword">if</span>(ischar(str) == false)
0458                 error(<span class="string">'&lt;Type&gt; must be &quot;matchCorrel&quot;'</span>);
0459             <span class="keyword">end</span>
0460             
0461             <span class="keyword">if</span> (strcmp(str,<span class="string">'matchCorrel'</span>))
0462                 flag = 1;   
0463             <span class="keyword">else</span>
0464                 error(<span class="string">'&lt;Type&gt; must be &quot;matchCorrel&quot;'</span>);
0465             <span class="keyword">end</span>
0466             
0467         <span class="keyword">end</span>
0468     <span class="keyword">end</span>
0469     
0470 <span class="keyword">end</span>
0471</pre></div>
<hr><address>Generated on Fri 27-Jan-2012 16:18:41 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>